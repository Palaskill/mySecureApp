<div class="dashboard-container">
  <!-- Stats Grid -->
  <div class="dashboard-grid">
    <div class="dashboard-card">
      <div class="card-header">
        <div class="card-icon">
          <i class="fas fa-shield-alt"></i>
        </div>
        <h3>Security Status</h3>
      </div>
      <p>Your connection is secure and encrypted</p>
      <div class="status-indicator active">
        <span class="dot"></span>
        Protected
      </div>
    </div>

    <div class="dashboard-card">
      <div class="card-header">
        <div class="card-icon">
          <i class="fas fa-clock"></i>
        </div>
        <h3>Session Info</h3>
      </div>
      <p>Current session is active and valid</p>
      <div class="status-indicator active">
        <span class="dot"></span>
        Active
      </div>
    </div>

    <div class="dashboard-card">
      <div class="card-header">
        <div class="card-icon">
          <i class="fas fa-desktop"></i>
        </div>
        <h3>Device Info</h3>
      </div>
      <p>Current device and location details</p>
      <div class="status-indicator active">
        <span class="dot"></span>
        Web Browser
      </div>
    </div>

    <div class="dashboard-card">
      <div class="card-header">
        <div class="card-icon">
          <i class="fas fa-lock"></i>
        </div>
        <h3>Last Login</h3>
      </div>
      <p>Your last authentication time</p>
      <div class="status-indicator active">
        <span class="dot"></span>
        {{ getCurrentDateTime() }}
      </div>
    </div>
  </div>

  <!-- Admin Section -->
  <div *ngIf="isAdmin" class="admin-section">
    <!-- Existing Users Section -->
    <div class="admin-card">
      <div class="section-header">
        <h2>Existing Users</h2>
        <p>Manage user accounts and privileges</p>
      </div>

      <div class="users-list" *ngIf="users.length > 0">
        <div class="user-card" *ngFor="let user of users">
          <div class="user-info">
            <div class="email">
              <i class="fas fa-user"></i>
              {{ user.email }}
            </div>
            <div class="details">
              <span class="role">
                <i class="fas fa-shield-alt"></i>
                {{ user.role.charAt(0).toUpperCase() + user.role.slice(1) }}
              </span>
              <span class="status" [class.active]="user.status === 'active'">
                <i class="fas fa-circle"></i>
                {{ user.status }}
              </span>
              <span class="date">
                <i class="fas fa-calendar"></i>
                {{ user.created_at | date:'mediumDate' }}
              </span>
            </div>
          </div>
          <div class="user-actions">
            <div class="role-select" (clickOutside)="selectedRoleIndex = -1">
              <div class="selected-option" [class]="getRoleClass(user.newRole)" (click)="toggleRoleSelect(user.id)">
                <i class="fas" [class]="getRoleIcon(user.newRole)"></i>
                <span>{{ user.newRole }}</span>
                <i class="fas fa-chevron-down dropdown-arrow"></i>
              </div>
              <div class="options-dropdown" *ngIf="selectedRoleIndex === user.id">
                <div 
                  class="option" 
                  *ngFor="let option of roleOptions"
                  [class]="getRoleClass(option.value)"
                  (click)="selectRole(user, option.value)"
                >
                  <i class="fas" [class]="option.icon"></i>
                  <span>{{ option.label }}</span>
                </div>
              </div>
            </div>
            <button 
              class="btn" 
              [class.btn-deactivate]="user.status === 'active'"
              [class.btn-activate]="user.status === 'inactive'"
              (click)="toggleUserStatus(user)"
            >
              <i class="fas" [class.fa-lock]="user.status === 'active'" [class.fa-unlock]="user.status === 'inactive'"></i>
              {{ user.status === 'active' ? 'Deactivate' : 'Activate' }}
            </button>
            <button class="btn btn-password" (click)="openChangePasswordDialog(user)">
              <i class="fas fa-key"></i>
              Change Password
            </button>
          </div>
        </div>
      </div>

      <div class="no-users" *ngIf="users.length === 0">
        <i class="fas fa-users"></i>
        <p>No users found</p>
      </div>
    </div>

    <!-- Pending Signups Section -->
    <div class="admin-card">
      <div class="section-header">
        <h2>Pending Sign-up Requests</h2>
        <p>Review and process new signup requests</p>
      </div>

      <div class="pending-requests" *ngIf="pendingSignups.length > 0">
        <div class="request-card" *ngFor="let signup of pendingSignups">
          <div class="request-info">
            <div class="email">
              <i class="fas fa-envelope"></i>
              {{ signup.email }}
            </div>
            <div class="date">
              <i class="fas fa-clock"></i>
              {{ signup.requestDate | date:'medium' }}
            </div>
          </div>
          <div class="request-actions">
            <div class="role-select">
              <select [(ngModel)]="signup.selectedRole">
                <option [value]="UserRole.USER">User</option>
                <option [value]="UserRole.OPERATOR">Operator</option>
                <option [value]="UserRole.BOSS">Boss</option>
                <option [value]="UserRole.CHIEF">Chief</option>
                <option [value]="UserRole.ADMIN">Admin</option>
              </select>
            </div>
            <button class="btn btn-approve" (click)="processSignup(signup.id, 'approve', signup.selectedRole)">
              <i class="fas fa-check"></i> Approve
            </button>
            <button class="btn btn-reject" (click)="processSignup(signup.id, 'reject')">
              <i class="fas fa-times"></i> Reject
            </button>
          </div>
        </div>
      </div>

      <div class="no-requests" *ngIf="pendingSignups.length === 0">
        <i class="fas fa-inbox"></i>
        <p>No pending signup requests</p>
      </div>
    </div>

    <!-- Rejected Accounts Section -->
    <div class="admin-card">
      <div class="section-header">
        <h2>Rejected Accounts</h2>
        <p>Review and manage rejected accounts</p>
      </div>

      <div class="rejected-accounts" *ngIf="rejectedAccounts.length > 0">
        <div class="request-card" *ngFor="let account of rejectedAccounts">
          <div class="request-info">
            <div class="email">
              <i class="fas fa-user-times"></i>
              {{ account.email }}
            </div>
            <div class="details">
              <span class="date">
                <i class="fas fa-clock"></i>
                Rejected: {{ account.requestDate | date:'medium' }}
              </span>
              <span class="date">
                <i class="fas fa-calendar"></i>
                Requested: {{ account.requestDate | date:'medium' }}
              </span>
              <span class="notes" *ngIf="account.notes">
                <i class="fas fa-sticky-note"></i>
                {{ account.notes }}
              </span>
            </div>
          </div>
          <div class="request-actions">
            <div class="role-select" (clickOutside)="selectedRoleIndex = -1">
              <div class="selected-option" [class]="getRoleClass(account.selectedRole)" (click)="toggleRoleSelect(account.id)">
                <i class="fas" [class]="getRoleIcon(account.selectedRole)"></i>
                <span>{{ account.selectedRole }}</span>
                <i class="fas fa-chevron-down dropdown-arrow"></i>
              </div>
              <div class="options-dropdown" *ngIf="selectedRoleIndex === account.id">
                <div 
                  class="option" 
                  *ngFor="let option of roleOptions"
                  [class]="getRoleClass(option.value)"
                  (click)="selectRoleForAccount(account, option.value)"
                >
                  <i class="fas" [class]="option.icon"></i>
                  <span>{{ option.label }}</span>
                </div>
              </div>
            </div>
            <button class="btn btn-approve" (click)="reapproveAccount(account)">
              <i class="fas fa-redo"></i> Reapprove
            </button>
          </div>
        </div>
      </div>

      <div class="no-requests" *ngIf="rejectedAccounts.length === 0">
        <i class="fas fa-ban"></i>
        <p>No rejected accounts</p>
      </div>
    </div>
  </div>
</div> 

<!-- Password Change Dialog -->
<div class="modal-overlay" *ngIf="selectedUser && showPasswordDialog">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Change Password</h3>
      <button class="close-button" (click)="closePasswordDialog()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="user-info">
        <i class="fas fa-user-circle"></i>
        <p>Change password for: <strong>{{ selectedUser.email }}</strong></p>
      </div>
      <div class="form-group">
        <label for="newPassword">New Password</label>
        <div class="password-input">
          <i class="fas fa-key"></i>
          <input 
            type="password" 
            id="newPassword"
            [(ngModel)]="newPassword" 
            placeholder="Enter new password"
            class="form-control">
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closePasswordDialog()">
        <i class="fas fa-times"></i> Cancel
      </button>
      <button class="btn btn-primary" (click)="changePassword()" [disabled]="!newPassword">
        <i class="fas fa-save"></i> Save Changes
      </button>
    </div>
  </div>
</div>

<style>
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.modal-content {
  background-color: white;
  border-radius: 8px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  width: 100%;
  max-width: 500px;
  position: relative;
}

.modal-header {
  padding: 20px;
  border-bottom: 1px solid #eee;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.modal-header h3 {
  margin: 0;
  color: #333;
}

.close-button {
  background: none;
  border: none;
  font-size: 24px;
  cursor: pointer;
  color: #666;
}

.close-button:hover {
  color: #333;
}

.modal-body {
  padding: 20px;
}

.form-group {
  margin-bottom: 15px;
}

.form-group label {
  display: block;
  margin-bottom: 5px;
  color: #666;
}

.form-control {
  width: 100%;
  padding: 8px 12px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 14px;
}

.form-control:focus {
  border-color: #2196F3;
  outline: none;
  box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.1);
}

.modal-footer {
  padding: 20px;
  border-top: 1px solid #eee;
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}

.btn {
  padding: 8px 16px;
  border-radius: 4px;
  font-size: 14px;
  cursor: pointer;
  border: none;
  transition: background-color 0.2s;
}

.btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.btn-primary {
  background-color: #2196F3;
  color: white;
}

.btn-primary:hover:not(:disabled) {
  background-color: #1976D2;
}

.btn-secondary {
  background-color: #757575;
  color: white;
}

.btn-secondary:hover {
  background-color: #616161;
}

.btn-password {
  background-color: #ff9800;
  color: white;
  display: flex;
  align-items: center;
  gap: 8px;
}

.btn-password:hover {
  background-color: #f57c00;
}

.btn-password i {
  font-size: 14px;
}

.user-actions {
  display: flex;
  gap: 10px;
  align-items: center;
}

.user-actions .btn {
  min-width: 120px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.btn-activate {
  background-color: #4CAF50;
  color: white;
}

.btn-activate:hover {
  background-color: #388E3C;
}

.btn-deactivate {
  background-color: #f44336;
  color: white;
}

.btn-deactivate:hover {
  background-color: #d32f2f;
}

.user-info {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 20px;
  padding: 15px;
  background-color: #f5f5f5;
  border-radius: 6px;
}

.user-info i {
  font-size: 24px;
  color: #2196F3;
}

.user-info p {
  margin: 0;
  color: #333;
}

.user-info strong {
  color: #1976D2;
}

.password-input {
  position: relative;
  display: flex;
  align-items: center;
}

.password-input i {
  position: absolute;
  left: 12px;
  color: #666;
}

.password-input input {
  padding-left: 35px;
}

.modal-footer .btn {
  display: flex;
  align-items: center;
  gap: 8px;
}

.modal-footer .btn i {
  font-size: 14px;
}

.btn-primary {
  background-color: #2196F3;
  color: white;
  min-width: 120px;
}

.btn-primary:hover:not(:disabled) {
  background-color: #1976D2;
}

.btn-primary:disabled {
  background-color: #90CAF9;
}

.btn-secondary {
  background-color: #757575;
  color: white;
  min-width: 100px;
}

.btn-secondary:hover {
  background-color: #616161;
}
</style> 